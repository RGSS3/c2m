<script src='https://unpkg.com/vue'></script>
<script src='https://unpkg.com/element-ui'></script>
<link href='https://unpkg.com/element-ui@1.3.7/lib/theme-default/index.css' rel='stylesheet'></link>
<style>
    html,
    body {
        -webkit-app-region: drag;
        background: transparent;
    }

    body, .el-input *::-webkit-input-placeholder{
        font-family: 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;
        -webkit-font-smoothing: subpixel-antialiased;
        text-shadow: 1px 1px 1px #eee;
    }

    button, input, div[class^='el-'], a{
        -webkit-app-region: no-drag;
    }

    .el-input input{
            font-family: 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;
    }
    .el-slider__button-wrapper{
        display: none;
    }

    .el-slider__runway{
        margin: 0px;
    }
    .el-slider__bar{
        background: #666;
    }
</style>
<div id='app'></div>


<script>
  let form = `
    <div @keyup.enter='play' style='background: transparent; border-radius: 4px; border: 1px solid transparent; padding: 15px 15px 5px;'>
    <el-row>
    <el-input v-model='keyword' icon='search' :on-icon-click='play' :placeholder='status.title'>
       <span slot='prepend' v-text='format(status.now)'></span>  
    </el-input>
    </el-row>
    
    <div v-if='status.curlrc' style='padding-top: 10px; white-space: pre; overflow: hidden; text-align:center; word-break: break-all;word-wrap: break-word; justify-content: space-between;font-size: 12px; color: #999;'>{{status.curlrc.trim()}}</div>

    <div v-if='!status.curlrc' style='padding-top: 10px; display: flex; justify-content: space-between;font-size: 12px; color: #CCC;'>
    <div>{{status.author}} {{status.album}}</div>
    <div><a style='color: #666; text-decoration: none;font-weight: bold;' target="_blank" :href='status.url'>云音乐</a></div>
    </div>
    <el-slider :max='status.all' @change='changeTime' v-model='status.now' :format-tooltip='format'></el-slider>
    </div>
    
    
  `;

  let data = ()=>({
    keyword: '',
    handle: '',
    status: {
      now: 0,
      all: 100,
      title: '',
      url: '',
      curlrc: '',
      author: '',
      album: '',
    },
    changing: false
  })

  let {ipcRenderer: R} = require('electron');
  let temp;
  let app = new Vue({
    el: '#app',
    template: form,
    data,
    methods: {
        play(){
            R.send('play163', {value: this.keyword, id: this.handle})
            this.keyword = '';
        },
        format(val){
          let b = val % 60, a = (val - b) / 60;
          return `0${a}`.slice(-2) + ":" + `0${b}`.slice(-2);
        },
        changeTime(val){
            if(temp != val){
                R.send("seek", {id: this.handle, now: val, all: this.status.all})
            }
        }
    }
  });

   R.on('id', (e, id) => app.handle = id);
   
   R.on('status', (e, a) => {
     app.status = a;
     temp = a.now;
   });
</script>
